<html>
<head>
    <title>Favourite Tweets</title>
    <script src="js/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="js/jquery.mobile-1.3.0-rc.1.js" type="text/javascript"></script>
	<script src="js/jquery.sparkline.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="css/custom.css">
    <link rel="stylesheet" href="css/jqm-demos.css">
    <link rel="stylesheet" href="css/jquery.mobile-1.3.0-rc.1.css">

	<style>
 	body{ height:100%; width:100%; }

	@media screen and (max-width: 525px) {
		#text {font-size:80%;}
		#src {display:none;}
		#date {display:none;}

		.extra{
			width:95%;
		}

		#addonInfo {
			font-size:85%;
		}

		#imgblock {
			display:none;
		}

		#imglink {
			display:inline;
		}

		#tweetdata {
			width:100%;
			font-size:85%;
		}

		#headblock{
			width:20%;
		}

		#tailblock {
			width:80%;
		}
	}

	/* If large screen, display additional info in a fixed box size*/
	@media screen and (min-width: 525px) {
		.extra{
			height:640px;
			width:500px;
		}

		#imglink {
			display:none;
		}
			
		#imgblock {
			width:30%;
		}

		#addonInfo {
			font-size:90%;
		}

		#tweetdata {
			width:70%;
		}

		#headblock{
			width:10%;
		}

		#tailblock {
			width:90%;
		}
	}

	</style>

</head>

<body>
</body>


<script type="text/javascript">
	var pagenum = 0;
	var entry_limit = 2;
	var MAX_PAGE = 0;
	var curpage = 0;

	$.ajaxSetup({ async: false });

    $.getJSON('model.json', function (data) {

		data.sort( function (a, b) {
			return a.user.screen_name.toLowerCase() == b.user.screen_name.toLowerCase() ? 0 : (a.user.screen_name.toLowerCase() < b.user.screen_name.toLowerCase() ? -1 : 1);
		});

        for (var i = 0; i < data.length; i++) {
	    	if(i % entry_limit == 0) {
				pagenum = i / entry_limit;
				MAX_PAGE = pagenum;
				createDiv(pagenum);
    		}
			populateDiv(data[i], pagenum);
       	}
		
		//add swipe bar for each page
		for (var i = 0; i <=MAX_PAGE; i++) {
		$('<ul data-role="listview" data-inset="true" data-theme="a" class="bar" data-position="fixed" data-id="samef"><li id="listitem">Swipe here to navigate ('+(i+1)+'/'+(MAX_PAGE+1)+') </li></ul>').appendTo($('#page'+i));
		}
    });

	$(document).ready(function() {
		$.mobile.changePage("#page0");

		$(".bar").swiperight(function() {
			curpage--;
	   		if (curpage < 0) {
		   		curpage = 0;
			}
			$.mobile.changePage("#page"+curpage, { transition: "fade"});
		});   

		$(".bar").swipeleft(function() {
			curpage++;
			if (curpage > MAX_PAGE) {
			   curpage = MAX_PAGE;
			}
			$.mobile.changePage("#page"+curpage, { transition: "fade"});
		});
	});



	function createDiv(pagenum){
		var shtml = '';
		shtml=shtml+'<div data-role="page" id="page'+pagenum+'"class="page">';

		shtml=shtml+'<div id="title" data-role="header" data-theme="b" data-id="sameh" data-position="fixed">';
		shtml=shtml+'<h1 style="text-align:left">Your Tweets</h1>';
		shtml=shtml+'<a class="ui-btn-right" href="#popupBasic'+pagenum+'" data-role="button" data-inline="true" data-rel="popup" data-transition="slidedown">Help</a>';

		shtml=shtml+'<div id="popupBasic'+pagenum+'" data-role="popup">';
		shtml=shtml+'<p>Click profile headers to expand for more data</p>';
		shtml=shtml+'<p>Swipe bottom bar to change pages</p>';
		shtml=shtml+'<p>Click images in popup to expand/open in new page</p>';
		shtml=shtml+'</div>';
		shtml=shtml+'</div><!-- /header -->';
		
		shtml=shtml+'<div data-role="content">';
	   
		shtml=shtml+'<ul id="list'+pagenum+'" class="ui-icon-alt" data-role="listview" data-inset="true" style="word-wrap:break-word"></ul>';

		shtml=shtml+'</div><!-- /content -->';
	 
		shtml=shtml+'<!-- Library of additonal data -->';
		shtml=shtml+'<div id="dataLibrary'+pagenum+'"><div>';

	    shtml=shtml+' <div class="jqm-footer">';
		shtml=shtml+'<p class="jqm-version"></p>';
		shtml=shtml+'<p>&copy; 2010, 2013 jQuery Foundation and other contributors:</p>';
		shtml=shtml+'</div><!-- /jqm-footer -->';
		
		shtml=shtml+'</div><!-- /page -->';
		$(shtml).appendTo('body');
    }

	function populateDiv(data, pagenum) {
		// Personal Data
		var profileIm = data.user.profile_image_url;	
		var url = data.user.url;
		var name = data.user.name;
		var scrname = data.user.screen_name;
		var desc = data.user.description;
		var timezone = data.user.time_zone;
		var language = data.user.lang;
		var createdate = data.user.created_at;
		var location; 
		var src;

		// Retreieve Location only if given
		if (data.user.location == "") {
			location = "n/a";
		} else {
			location = data.user.location;
		}
		// Retrieve source url only if given
		if (data.source == "web") {
			src = "web";
		} else {
			src = '<a target="_blank" ' + (data.source).substring(3);
		}
		
		// Tweet related data
		var text = data.text;
		var id = data.id;
		var date = data.created_at;
		var urlList = data.entities.urls;
         	
		// Load in main page data
		var shtml='';  
		shtml=shtml+'<li id="profile">';
		shtml=shtml+ '<a href="#' + id +'" data-rel="popup" data-transition="pop">';

		// Profile header information
		shtml=shtml+'<div class="ui-grid-a">';
		shtml=shtml+'<div id="headblock" class="ui-block-a">';
        shtml=shtml+'<img id="icon" src="'+profileIm+'">';
		shtml=shtml+'</div>';
		shtml=shtml+'<div id="tailblock" class="ui-block-b">';
        shtml=shtml+'<h1 id="scrname" style="height:40%; font-size:85%; text-align:left">'+scrname+'</h1>'
		shtml=shtml+'<p id="date" style="height:60%; font-size:75%; text-align:left">'+date+'</p>';
		shtml=shtml+'</div>';
		shtml=shtml+'</div>';
		shtml=shtml+'</a>';
			
		// Profile description information
		shtml=shtml+'<div style="border:10px transparent solid">';
		shtml=shtml+'<p>_ _ _ _ _</p>';
        shtml=shtml+'<p id="text" style="white-space:normal">'+findLinks(text, urlList)+'</p>';

		// Display source only if given
		shtml=shtml+'<p id="src">Source: '+src+'</p>';
		shtml=shtml+'</div>';

        shtml=shtml+'</li>';
	
		$('#list'+pagenum).append(shtml);

		// Load in pop-up additional info
		shtml=''; 
		shtml=shtml+'<div class="extra" id="' + id + '" data-role="popup" data-theme="d" data-overlay-theme="a">';

		// Profile information
		shtml=shtml+'<div data-role="header" data-theme="b" style="height:48px">';
		shtml=shtml+'<img border="0" id="popupID" src="'+profileIm+'" style="float:left;display:inline">';
		shtml=shtml+'<h1>'+scrname+'</h1>';
		shtml=shtml+'</div>';

		shtml=shtml+'<p><b>Real Name: </b>'+name+'</p>';
		shtml=shtml+'<p style="font-size: 85%"><b>Location: </b>'+location+'<br>';
		shtml=shtml+'<b>Account created on: </b>'+createdate+'<br>';
		shtml=shtml+'<b>Timezone: </b>'+timezone+'<br>';
		shtml=shtml+'<b>Language: </b>'+language+'<br>';
		shtml=shtml+'<b>Page: </b><a href="'+url+'" class="outlink" target="_blank"> '+url+'</a></p>';
		shtml=shtml+'<p style="font-size:80%">'+desc+'</p>';

		// Additional Tweet data
		shtml=shtml+'<div data-role="navbar"> <ul><li><a class="ui-btn-active">Tweet Data</a></li></ul></div>';
		
		// Basic Tweet info
		shtml=shtml+'<div class="ui-grid-a">';
		if (data.entities.media != undefined){
			// Only show image of type photo
			if (data.entities.media[0].type == "photo") {
				var tweetImg = data.entities.media[0].media_url;
				shtml=shtml+'<div id="imgblock" class="ui-block-a" style="width: 30%">';

				shtml=shtml+'<a href="'+tweetImg+'" target="_blank">';
				shtml=shtml+'<img src="'+tweetImg+'" >';

				shtml=shtml+'</a></div>';
			}
		}

		shtml=shtml+'<div id="tweetdata" class="ui-block-b" style="border:10px white solid">';
		shtml=shtml+'<h3>'+scrname+'</h3>';
		shtml=shtml+'<p>'+findLinks(text, urlList)+'</p>';
		shtml=shtml+'</div>';
		shtml=shtml+'</div>';

		// Additional Tweet info
		shtml=shtml+'<div id="addonInfo"style="border:10px white solid">';
		shtml=shtml+'<p><b>Source: </b>'+src+'</p>';
		shtml=shtml+'<p><b>Created at : </b>'+date+'<br>';
		shtml=shtml+'<b>Retweet Count : </b>'+data.retweet_count+'<br>';

		var mentions = data.entities.user_mentions;
		for(var i = 0; i < mentions.length; i++) {
			if (i == 0) {
				shtml=shtml+'<b>Users mentioned: </b>';
 			} else {
				shtml=shtml+", "
			}	

			shtml=shtml+mentions[i].screen_name;
		}

		if (data.entities.media != undefined){
			// Only show image of type photo
			if (data.entities.media[0].type == "photo") {
				var tweetImg = data.entities.media[0].media_url;
				shtml=shtml+'<div id="imglink">';

				shtml=shtml+'<b>Image : </b><a href="'+tweetImg+'" target="_blank">';
				shtml=shtml+'link';

				shtml=shtml+'</a></div>';
			}
		}

		shtml=shtml+'</p></div>';

		// Back button 
		shtml=shtml+'<a href="#back" data-role="button" data-theme="b" data-corners="false">Back</a>';
		shtml=shtml+'</div>';
		$('#dataLibrary'+pagenum).append(shtml);
	}


	//add <a> tags to links in text
	function findLinks(text, urlList) {
		var temp;
		for(var i = 0; i < urlList.length; i++) {
			temp = text.replace(urlList[i].url, '<a href="'+urlList[i].url+'" target="_blank">'+urlList[i].url+'</a>');
			text = temp;		
		}
		return temp;
	}

</script>

</html>
